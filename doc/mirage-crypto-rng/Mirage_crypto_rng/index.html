<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mirage_crypto_rng (mirage-crypto-rng.Mirage_crypto_rng)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">mirage-crypto-rng</a> &#x00BB; Mirage_crypto_rng</nav><h1>Module <code>Mirage_crypto_rng</code></h1><h2 id="randomness"><a href="#randomness" class="anchor"></a>Randomness</h2><nav class="toc"><ul><li><a href="#usage-notes">Usage notes</a></li><li><a href="#interface">Interface</a></li><li><a href="#rng_examples">Examples</a></li></ul></nav></header><aside><p>Secure random number generation.</p><p>There are several parts of this module:</p><ul><li>The <a href="module-type-Generator/index.html"><span>signature</span></a> of generator modules, together with a facility to convert such modules into actual <a href="index.html#type-g"><span>generators</span></a>, and functions that operate on this representation.</li><li>A global generator instance, which needs to be initialized by calling <a href="index.html#val-set_default_generator"><code>set_default_generator</code></a>.</li></ul></aside><section><header><h2 id="usage-notes"><a href="#usage-notes" class="anchor"></a>Usage notes</h2></header><aside><p><b>TL;DR</b> Don't forget to seed; don't maintain your own <code>g</code>.</p><p>The RNGs here are merely the deterministic part of a full random number generation suite. For proper operation, they need to be seeded with a high-quality entropy source.</p><p>Suitable generators are provided by sub-libraries <a href="../Mirage_crypto_rng_lwt/index.html"><span>mirage-crypto-rng.lwt</span></a> (for Lwt), <a href="../Mirage_crypto_rng_mirage/index.html"><span>mirage-crypto-rng.mirage</span></a> (for MirageOS), and <a href="../Mirage_crypto_rng_unix/index.html"><span>mirage-crypto-rng.unix</span></a>. Although this module exposes a more fine-grained interface, allowing manual seeding of generators, this is intended either for implementing entropy-harvesting modules, or very specialized purposes. Users of this library should almost certainly use one of the above entropy libraries, and avoid manually managing the generator seeding.</p><p>Similarly, although it is possible to swap the default generator and gain control over the random stream, this is also intended for specialized applications such as testing or similar scenarios where the RNG needs to be fully deterministic, or as a component of deterministic algorithms which internally rely on pseudorandom streams.</p><p>In the general case, users should not maintain their local instances of <a href="index.html#type-g"><span>g</span></a>. All of the generators in a process have to compete for entropy, and it is likely that the overall result will have lower effective unpredictability.</p><p>The recommended way to use these functions is either to accept an optional generator and pass it down, or to ignore the generator altogether, as illustrated in the <a href="index.html#rng_examples"><span>examples</span></a>.</p></aside><dl><dt class="spec type" id="type-bits"><a href="#type-bits" class="anchor"></a><code><span class="keyword">type</span> bits</code><code> = int</code></dt></dl></section><section><header><h2 id="interface"><a href="#interface" class="anchor"></a>Interface</h2></header><dl><dt class="spec type" id="type-g"><a href="#type-g" class="anchor"></a><code><span class="keyword">type</span> g</code></dt><dd><p>A generator (PRNG) with its state.</p></dd></dl><dl><dt class="spec exception" id="exception-Unseeded_generator"><a href="#exception-Unseeded_generator" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Unseeded_generator</span></code></dt><dd><p>Thrown when using an uninitialized <a href="index.html#type-g"><span>generator</span></a>.</p></dd></dl><dl><dt class="spec exception" id="exception-No_default_generator"><a href="#exception-No_default_generator" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">No_default_generator</span></code></dt><dd><p>Thrown when <code>set_generator</code> has not been called.</p></dd></dl><dl><dt class="spec module-type" id="module-type-Generator"><a href="#module-type-Generator" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Generator/index.html">Generator</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>A single PRNG algorithm.</p></dd></dl><dl><dt class="spec type" id="type-generator"><a href="#type-generator" class="anchor"></a><code><span class="keyword">type</span> <span>'a generator</span></code><code> = <span>(<span class="keyword">module</span> <a href="module-type-Generator/index.html">Generator</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Generator/index.html#type-g">g</a> = <span class="type-var">'a</span>)</span></code></dt></dl><aside><p>Ready-to-use RNG algorithms.</p></aside><dl><dt class="spec module" id="module-Fortuna"><a href="#module-Fortuna" class="anchor"></a><code><span class="keyword">module</span> <a href="Fortuna/index.html">Fortuna</a> : <a href="index.html#module-type-Generator">Generator</a></code></dt><dd><p><b>Fortuna</b>, a CSPRNG <a href="https://www.schneier.com/fortuna.html">proposed</a> by Schneier.</p></dd></dl><dl><dt class="spec module" id="module-Hmac_drbg"><a href="#module-Hmac_drbg" class="anchor"></a><code><span class="keyword">module</span> <a href="Hmac_drbg/index.html">Hmac_drbg</a> : <span class="keyword">functor</span> (<a href="Hmac_drbg/argument-1-H/index.html">H</a> : <a href="../../mirage-crypto/Mirage_crypto/Hash/index.html#module-type-S">Mirage_crypto.Hash.S</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-Generator">Generator</a></code></dt><dd><p><b>HMAC_DRBG</b>: A NIST-specified RNG based on HMAC construction over the provided hash.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>?&#8288;g:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;seed:Cstruct.t</span> <span>&#45;&gt;</span> <span>?&#8288;strict:bool</span> <span>&#45;&gt;</span> <span>?&#8288;time:<span>(unit <span>&#45;&gt;</span> int64)</span></span> <span>&#45;&gt;</span> <span>(<span class="keyword">module</span> <a href="module-type-Generator/index.html">Generator</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-Generator/index.html#type-g">g</a> = <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-g">g</a></code></dt><dd><p><code>create ~g ~seed ~strict ~time module</code> uses a module conforming to the <a href="module-type-Generator/index.html"><span>Generator</span></a> signature to instantiate the generic generator <a href="index.html#type-g"><span>g</span></a>.</p><p><code>g</code> is the state to use, otherwise a fresh one is created.</p><p><code>seed</code> can be provided to immediately reseed the generator with.</p><p><code>strict</code> puts the generator into a more standards-conformant, but slighty slower mode. Useful if the outputs need to match published test-vectors.</p><p><code>time</code> is used to limit the amount of reseedings. Fortuna uses at most once every second.</p></dd></dl><dl><dt class="spec value" id="val-default_generator"><a href="#val-default_generator" class="anchor"></a><code><span class="keyword">val</span> default_generator : unit <span>&#45;&gt;</span> <a href="index.html#type-g">g</a></code></dt><dd><p><code>default_generator ()</code> is the default generator. Functions in this module use this generator when not explicitly supplied one.</p><dl><dt>raises No_default_generator</dt><dd><p>if <code>set_generator</code> has not been called.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-set_default_generator"><a href="#val-set_default_generator" class="anchor"></a><code><span class="keyword">val</span> set_default_generator : <a href="index.html#type-g">g</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>set_default_generator g</code> sets the default generator to <code>g</code>. This function must be called once.</p></dd></dl><dl><dt class="spec value" id="val-generate"><a href="#val-generate" class="anchor"></a><code><span class="keyword">val</span> generate : <span>?&#8288;g:<a href="index.html#type-g">g</a></span> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> Cstruct.t</code></dt><dd><p>Invoke <a href="module-type-Generator/index.html#val-generate"><span>generate</span></a> on <code>g</code> or <a href="index.html#type-generator"><span>default generator</span></a>.</p></dd></dl><dl><dt class="spec value" id="val-block"><a href="#val-block" class="anchor"></a><code><span class="keyword">val</span> block : <span><a href="index.html#type-g">g</a> option</span> <span>&#45;&gt;</span> int</code></dt><dd><p><a href="module-type-Generator/index.html#val-block"><span>Block</span></a> size of <code>g</code> or <a href="index.html#type-generator"><span>default generator</span></a>.</p></dd></dl></section><section><header><h2 id="rng_examples"><a href="#rng_examples" class="anchor"></a>Examples</h2><p>Generating a random 13-byte <span class="xref-unresolved" title="unresolved reference to &quot;Cstruct.t&quot;"><code>Cstruct</code>.t</span>:</p><pre><code class="ml">let cs = Rng.generate 13</code></pre><p>Generating a list of <span class="xref-unresolved" title="unresolved reference to &quot;Cstruct.t&quot;"><code>Cstruct</code>.t</span>, passing down an optional <a href="index.html#type-g"><span>generator</span></a>:</p><pre><code class="ml">let rec f1 ?g ~n i =
if i &lt; 1 then [] else Rng.generate ?g n :: f1 ?g ~n (i - 1)</code></pre><p>Generating a <code>Z.t</code> smaller than <code>10</code>:</p><pre><code class="ml">let f2 ?g () = Mirage_crypto_pk.Z_extra.gen ?g Z.(~$10)</code></pre><p>Creating a local Fortuna instance and using it as a key-derivation function:</p><pre><code class="ml">let f3 secret =
let g = Rng.(create ~seed:secret (module Generators.Fortuna)) in
Rng.generate ~g 32</code></pre></header><dl><dt class="spec module" id="module-Entropy"><a href="#module-Entropy" class="anchor"></a><code><span class="keyword">module</span> <a href="Entropy/index.html">Entropy</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Entropy sources and collection</p></dd></dl></section></div></body></html>